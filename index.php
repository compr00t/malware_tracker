<html>
<head>
	<style>
	  table, td, th { border: 1px solid black; }
	  td, th { padding: 5px; }
	  body, table { font-family: Verdana,Arial,Helvetica,sans-serif; font-size: 14px; }
	  th { text-align: left; }
	  .main { font-size: 14px; 
		  position:absolute;
		  width: 1200px;
		  left: 50%;
		  top: 0px;
		  margin-left: -623px;
		  border: 1px solid #ccc;
		  background-color: white;
		  padding: 22px; }
	  body { background-color: lightgray;}
	</style>
	<title>Malware Tracker :: Overview</title>
</head>
<body>

<div class="main">
<h3>Malware Tracker :: Overview</h3>
Give it some informations...
<br /><hr /><br />
<?php

	# Debug output for errors only
	error_reporting( E_ERROR );

	$bol = 1; # Boolean for row colors
	$statusColor;	# Just a variable
	$sblColor; # Just a variable

	$xml = new SimpleXMLElement('data.xml', 0, TRUE); # Load the xml to var
	if (isset($_GET["filter"])) { $filter = $_GET["filter"]; } else { $filter = "all"; } # Define a default filter

	# Create the filters, bold for a currently selected filter
	echo "<div class=\"filter\">";
	echo '<b>Filter</b>: <a href="'.basename($_SERVER['PHP_SELF']).'?filter=online">';
	if ($filter == "online") { echo "<b>"; } echo "Online"; if ($filter == "online") { echo "</b>"; } echo "</a> | ";
	echo '<a href="'.basename($_SERVER['PHP_SELF']).'?filter=offline">';
	if ($filter == "offline") { echo "<b>"; } echo "Offline"; if ($filter == "offline") { echo "</b>"; } echo "</a> | ";
	echo '<a href="'.basename($_SERVER['PHP_SELF']).'?filter=sbl_listed">';
	if ($filter == "sbl_listed") { echo "<b>"; } echo "has SBL"; if ($filter == "sbl_listed") { echo "</b>"; } echo "</a> | ";
	echo '<a href="'.basename($_SERVER['PHP_SELF']).'?filter=sbl_notlisted">';
	if ($filter == "sbl_notlisted") { echo "<b>"; } echo "has no SBL"; if ($filter == "sbl_notlisted") { echo "</b>"; } echo "</a> | ";
	echo '<a href="'.basename($_SERVER['PHP_SELF']).'?filter=asn_listed">';
	if ($filter == "asn_listed") { echo "<b>"; } echo "has ASN"; if ($filter == "asn_listed") { echo "</b>"; } echo "</a> | ";
	echo '<a href="'.basename($_SERVER['PHP_SELF']).'?filter=asn_notlisted">';
	if ($filter == "asn_notlisted") { echo "<b>"; } echo "has no ASN"; if ($filter == "asn_notlisted") { echo "</b>"; } echo "</a> | ";
	echo '<a href="'.basename($_SERVER['PHP_SELF']).'?filter=all">[X]</a>';

	# Create the basic HTML structure for the table
	echo "</div>";
	echo "<br />";

	echo "<center>";	
	echo "<table>";
	echo "  <thead>";
    	echo "    <tr>";
	echo "      <th>Date</th>";
        echo "      <th>Domain</th>";
        echo "      <th>IP</th>";
        echo "      <th>Country</th>";
        echo "      <th>State</th>";
        echo "      <th>SBL</th>";
        echo "      <th>ASN</th>";
        echo "      <th>AS Name</th>";
        echo "    </tr>";
        echo "  </thead>";
        echo "  <tbody>";

	# Function to display actual content
	function doPrint($entryElement) {
		global $bol;

		# do the coloring of the lines
                if ($bol) {
                        echo "    <tr style=\"background-color: lightgray;\">";
			$bol = 0;
                } else {
                        echo "    <tr>";
			$bol = 1;
                }

		# do the coloring of green / red for some fields
                if ($entryElement->status == "Online") { $statusColor = "red"; } else { $statusColor = "gray"; }
                if ($entryElement->sbl == "not listed") { $sblColor = "green"; } else { $sblColor = "red"; }

		# print the content
                echo "      <td>".$entryElement->date."</td>";
                echo "      <td>".$entryElement->domain."</td>";
                echo "      <td>".$entryElement->ip."</td>";
                echo "      <td>".$entryElement->country."</td>";
                echo "      <td style=\"background-color: ".$statusColor.";\">".$entryElement->status."</td>";
                echo "      <td style=\"background-color: ".$sblColor.";\">".$entryElement->sbl."</td>";
                echo "      <td>".$entryElement->asn."</td>";
                echo "      <td>".$entryElement->responsible."</td>";
                echo "    </tr>";
        }

	# loop through XML nodes
	foreach ($xml->malware->obj as $entryElement) :
		
		# do the filtering
		switch ($filter) {
			case "online":
				if ($entryElement->status == "Online") { doPrint($entryElement); }
				break;
			case "offline":
				if ($entryElement->status == "Offline") { doPrint($entryElement); }
				break;
			case "sbl_listed":
				if ($entryElement->sbl != "not listed") { doPrint($entryElement); }
				break;
			case "sbl_notlisted":
				if ($entryElement->sbl == "not listed") { doPrint($entryElement); }
				break;
			case "asn_listed":
				if ($entryElement->asn != "") { doPrint($entryElement); }
				break;
			case "asn_notlisted":
				if ($entryElement->asn == "") { doPrint($entryElement); }
				break;
			case "all":
				doPrint($entryElement);
				break;
			default:
				doPrint($entryElement);
				break;
		}
		
	endforeach;

	# do the finish for HTML strcuture
        echo "  </tbody>";
        echo "</table>";
        echo "<br />";

?>

Download all IPs in this tracker <a href="./ips.txt" target="_blank">here</a>.
</center>
</div>

</body>
</html>
